<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ff66">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js');
  });
}
</script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Matrix Weather ‚Äî RLB</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
if(window.pdfjsLib)
  pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js";
</script>

<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#000;
  font-family:Consolas,monospace;color:#00ff66;}
#matrixCanvas,#cloudCanvas{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;}
#matrixCanvas{z-index:0;}
#cloudCanvas{z-index:1;}
#floatingText{
 position:fixed;top:45%;left:50%;transform:translate(-50%,-50%);
 font-size:90px;font-weight:bold;letter-spacing:10px;
 color:rgba(0,0,0,0.5);
 text-shadow:0 0 10px rgba(0,255,0,0.4),
              0 0 20px rgba(0,255,0,0.5),
              0 0 40px rgba(0,255,0,0.3);
 animation:spin3D 4s ease-in-out infinite alternate;
 z-index:2;pointer-events:none;
}
@keyframes spin3D{
 0%{transform:translate(-50%,-50%) rotateY(-25deg) rotateX(10deg);}
100%{transform:translate(-50%,-50%) rotateY(25deg) rotateX(-10deg);}
}
#weatherBox{
 position:fixed;bottom:10px;right:15px;z-index:5;
 font-family:'Orbitron',sans-serif;font-size:11px;
 color:#ff4444;text-shadow:0 0 6px #ff0000,0 0 10px #ff3333;
 background:rgba(40,0,0,0.4);border:1px solid #ff0000;
 padding:6px 10px;border-radius:6px;box-shadow:0 0 12px #ff0000;
}
.topbar{position:relative;z-index:10;display:flex;justify-content:space-between;
  align-items:flex-start;padding:10px 15px;gap:10px;}
.upload-box{flex:0 0 130px;text-align:center;border:1.5px solid #00ff66;
  border-radius:4px;padding:6px 4px;background:rgba(0,40,0,.6);
  box-shadow:0 0 12px #00ff66;position:relative;}
input[type=file]{appearance:none;-webkit-appearance:none;position:relative;background:transparent;
 border:none;width:100%;height:22px;cursor:pointer;color:transparent;}
input[type=file]::-webkit-file-upload-button{visibility:hidden;}
input[type=file]::before{
 content:'Choose Files';position:absolute;left:50%;top:50%;
 transform:translate(-50%,-50%);font-size:10px;font-weight:600;letter-spacing:1px;
 background:linear-gradient(135deg,#e6ffe6 0%,#00ff88 40%,#005522 60%,#00ff88 100%);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
 text-shadow:0 0 8px rgba(0,255,100,0.6);transition:.2s;}
input[type=file]:hover::before{text-shadow:0 0 12px rgba(0,255,150,0.9);}
.upload-box p{font-size:7px;margin:3px 0 0;opacity:.6;}
.folder{flex:0 0 200px;border:1px solid #00ff66;border-radius:4px;
  background:rgba(0,30,0,.6);box-shadow:0 0 12px #00ff66;
  overflow:hidden;position:relative;z-index:20;}
.folder-header{padding:6px 8px;font-size:11px;color:#00ff66;
  border-bottom:1px solid #004400;text-shadow:0 0 5px #00ff66;
  display:flex;justify-content:space-between;align-items:center;cursor:pointer;}
.folder-content{max-height:200px;overflow-y:auto;padding:5px;font-size:9px;transition:.3s;}
.folder-content.collapsed{max-height:0;overflow:hidden;padding:0;}
h3{font-size:10px;color:#00ffaa;text-shadow:0 0 4px #00ffaa;margin:4px 0 3px;
 border-left:2px solid #00ffaa;padding-left:4px;}
.file-entry{border-bottom:1px solid #004400;padding:3px;font-size:9px;cursor:pointer;}
.file-entry:hover{background:rgba(0,255,0,.1);}
.viewer-box{
 position:absolute;top:65px;left:15px;z-index:5;width:70%;max-width:900px;
 background:rgba(0,20,0,.85);border:1px solid #00ff66;border-radius:5px;
 box-shadow:0 0 15px #00ff66;text-align:center;padding:6px;
 overflow-y:auto;max-height:65vh;transition:max-height .3s ease;}
.viewer-box.collapsed canvas,#timestamp{display:none;}
.viewer-header{font-size:14px;font-weight:bold;background:rgba(0,40,0,.9);
 padding:8px 0;cursor:pointer;color:#00ff99;text-shadow:0 0 10px #00ff99;
 border-radius:4px;margin-bottom:4px;border:1px solid #00ff66;
 transition:.2s;text-transform:uppercase;}
.viewer-header:hover{box-shadow:0 0 15px #00ff66,inset 0 0 5px #00ff66;}
#pdfCanvas{width:100%;border-radius:3px;border:1px solid #00ff66;box-shadow:0 0 8px #00ff66;}
#timestamp{font-size:9px;margin-top:4px;color:#00ffaa;text-shadow:0 0 4px #00ffaa;}
/* === Prediction Box (deeper look) === */
.generator{
  position:fixed;
  z-index:30;
  width:230px;
  background:rgba(0,20,0,0.9);
  border-radius:6px;
  padding:6px;
  text-align:center;
  cursor:move;
  overflow:hidden;
  font-family:'Orbitron',sans-serif;
  box-shadow:0 0 20px rgba(0,255,100,0.5);
}
.generator::before{
  content:"";
  position:absolute;
  inset:0;
  border:2px solid transparent;
  border-radius:6px;
  background:linear-gradient(90deg,transparent,rgba(0,255,100,0.8),transparent)0 0/200% 200%;
  animation:neon 1s linear infinite;
  filter:blur(1px);
  opacity:0.9;
  z-index:-1;
}
@keyframes neon{0%{background-position:0 0;}100%{background-position:200% 0;}}
.generator h4{margin:2px 0 5px;font-size:11px;color:#00ffcc;text-shadow:0 0 6px #00ffcc;}
.generator input,.generator select{width:70px;margin:2px;border:1px solid #00ff66;
 background:#000;color:#00ff99;font-size:9px;border-radius:3px;text-align:center;}
.generator button{margin-top:4px;background:#000;color:#00ffcc;border:1px solid #00ff66;
 border-radius:3px;padding:2px 7px;cursor:pointer;box-shadow:0 0 6px #00ff66;font-size:9px;}
.result-grid{
  margin-top:5px;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:3px;
  justify-items:center;
}
.result-cell{
  border:1px solid #00ff66;
  border-radius:2px;
  padding:3px 0;
  width:38px;
  font-size:10px;
  color:#00ffaa;
  box-shadow:0 0 6px #00ff66;
  transition:0.2s;
}
.result-cell.new{box-shadow:0 0 12px #00ffaa,0 0 20px #00ffaa;}
</style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>
<canvas id="cloudCanvas"></canvas>
<div id="floatingText">RLB</div>
<div id="weatherBox">Loading weather...</div>

<div class="topbar">
 <div class="upload-box">
   <input type="file" id="pdfInput" accept="application/pdf" multiple />
   <p id="uploadHint">No file selected</p>
 </div>
 <div class="folder" id="folderBox">
   <div class="folder-header" id="folderToggle"><span>üìÅ Saved Folder</span><span id="toggleIcon">‚àí</span></div>
   <div class="folder-content" id="folderContent"></div>
 </div>
</div>

<div class="viewer-box" id="viewerBox">
 <div class="viewer-header" id="viewerToggle">Preview ‚ñº</div>
 <canvas id="pdfCanvas"></canvas>
 <div id="timestamp"></div>
</div>

<div class="generator" id="generatorBox">
 <h4>Predictions</h4>
 <div>
   <input type="number" id="reqNum" min="0" max="99" placeholder="##" />
   <select id="qty">
     <option>1</option><option>2</option><option>3</option><option>4</option>
     <option>5</option><option>6</option><option>7</option><option>8</option>
     <option>9</option><option>10</option><option>11</option><option>12</option>
     <option>13</option><option>14</option><option>15</option>
   </select>
 </div>
 <button id="genBtn">Generate</button>
 <div class="result-grid" id="resultGrid"></div>
</div>

<script>
/* === Matrix Rain === */
const mc=document.getElementById("matrixCanvas"),ctx=mc.getContext("2d");
function resize(){mc.width=innerWidth;mc.height=innerHeight;}resize();addEventListener("resize",resize);
const letters="01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩABCDEFGHIJKLMNOPQRSTUVWXYZ";
const font=14;let drops=Array(Math.floor(innerWidth/font)).fill(1);
setInterval(()=>{ctx.fillStyle="rgba(0,0,0,0.08)";ctx.fillRect(0,0,mc.width,mc.height);
ctx.fillStyle="#00ff66";ctx.font=font+"px monospace";
drops.forEach((y,i)=>{const t=letters[Math.floor(Math.random()*letters.length)];
ctx.fillText(t,i*font,y*font);if(y*font>mc.height&&Math.random()>0.975)drops[i]=0;drops[i]++;});},33);

/* === Clouds + Weather === */
const LAT=23.66714,LON=86.80171;
const box=document.getElementById("weatherBox");
const cloudCanvas=document.getElementById("cloudCanvas");
const renderer=new THREE.WebGLRenderer({canvas:cloudCanvas,alpha:true});
renderer.setSize(innerWidth,innerHeight);renderer.setClearColor(0x000000,0);
const scene=new THREE.Scene();const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,1000);
camera.position.z=600;scene.fog=new THREE.FogExp2(0x001a00,0.0009);
const light=new THREE.DirectionalLight(0x00ff99,0.6);light.position.set(0,0,1);scene.add(light);
let cloudGroup=null;
function createClouds(count,opacity,color){if(cloudGroup){scene.remove(cloudGroup);}
if(count<=0)return;const g=new THREE.PlaneBufferGeometry(500,500);
const m=new THREE.MeshLambertMaterial({map:new THREE.TextureLoader().load("https://threejs.org/examples/textures/sprites/cloud10.png"),transparent:true,depthWrite:false,opacity:opacity,color:color});
cloudGroup=new THREE.Group();for(let i=0;i<count;i++){const c=new THREE.Mesh(g,m);
c.position.set(Math.random()*1000-500,Math.random()*500-250,Math.random()*500-500);
c.rotation.z=Math.random()*Math.PI;cloudGroup.add(c);}scene.add(cloudGroup);}
function animateClouds(){requestAnimationFrame(animateClouds);
if(cloudGroup)cloudGroup.rotation.y+=cloudGroup.speed||0.0006;renderer.render(scene,camera);}animateClouds();
addEventListener("resize",()=>{renderer.setSize(innerWidth,innerHeight);camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();});
async function loadWeather(){try{const res=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true`);
const data=await res.json();const w=data.current_weather;box.textContent=`üå° ${w.temperature}¬∞C | üí® ${w.windspeed} km/h`;
updateClouds(w.weathercode);}catch{box.textContent="Weather unavailable";updateClouds(1);}}
function updateClouds(code){if(code===0){createClouds(0,0,0x000000);}
else if(code>=1&&code<=3){createClouds(35,0.25,0x00ff99);}
else if((code>=45&&code<=67)||(code>=51&&code<=57)){createClouds(55,0.35,0x00cc66);}
else if(code>=80){createClouds(70,0.45,0x007733);}
else{createClouds(40,0.3,0x00aa55);}}
loadWeather();setInterval(loadWeather,600000);

/* === Upload + Folder + Viewer === */
const pdfInput=document.getElementById("pdfInput");
const folderContent=document.getElementById("folderContent");
const hint=document.getElementById("uploadHint");
const toggleIcon=document.getElementById("toggleIcon");
const folderToggle=document.getElementById("folderToggle");
let savedFiles=JSON.parse(localStorage.getItem("savedFiles")||"[]");let folderCollapsed=false;
folderToggle.onclick=()=>{folderCollapsed=!folderCollapsed;folderContent.classList.toggle("collapsed",folderCollapsed);
toggleIcon.textContent=folderCollapsed?"Ôºã":"‚àí";};
function saveLocal(){localStorage.setItem("savedFiles",JSON.stringify(savedFiles));}
function renderFiles(){const groups={"1PM":[],"6PM":[],"8PM":[]};
savedFiles.forEach(f=>{if(groups[f.time])groups[f.time].push(f);});
folderContent.innerHTML="";for(const t of ["1PM","6PM","8PM"]){if(groups[t].length){const sec=document.createElement("div");
sec.innerHTML=`<h3>${t}</h3>`;groups[t].forEach(f=>{const row=document.createElement("div");
row.className="file-entry";row.textContent=f.display;row.onclick=()=>showPDF(f.name);sec.appendChild(row);});
folderContent.appendChild(sec);}}}
pdfInput.addEventListener("change",()=>{const files=[...pdfInput.files];if(!files.length)return;
hint.textContent=files.length+" file(s)";files.forEach(file=>{const name=file.name.replace(/\.pdf$/i,"").toUpperCase();
if(savedFiles.some(f=>f.name===name))return;const ok=/^[A-Z]{2}\d{6}$/.test(name);if(!ok)return;
const L=name[0];const time=L==="M"?"1PM":L==="D"?"6PM":L==="E"?"8PM":"OTHER";
const d=name.slice(2,4),m=name.slice(4,6),y=name.slice(6,8);
const dt=new Date(2000+ +y,+m-1,+d);const display=`${+d}-${dt.toLocaleString("en-US",{month:"short"})}-${y}//${time}`;
savedFiles.push({name,time,display,date:dt.getTime()});});
savedFiles.sort((a,b)=>b.date-a.date);saveLocal();renderFiles();autoPreviewNewest();});
const viewerBox=document.getElementById("viewerBox");
const pdfCanvas=document.getElementById("pdfCanvas");
const timestamp=document.getElementById("timestamp");
const viewerToggle=document.getElementById("viewerToggle");let collapsed=false;
viewerToggle.onclick=()=>{collapsed=!collapsed;viewerBox.classList.toggle("collapsed",collapsed);
viewerToggle.textContent=collapsed?"Preview ‚ñ≤":"Preview ‚ñº";};
async function showPDF(name){const file=[...pdfInput.files].find(f=>f.name.replace(/\.pdf$/i,"").toUpperCase()===name);
if(!file)return alert("Upload this PDF first!");const reader=new FileReader();
reader.onload=async function(){const uint=new Uint8Array(this.result);
const pdf=await pdfjsLib.getDocument(uint).promise;const page=await pdf.getPage(1);
const viewport=page.getViewport({scale:1.2});const ctx=pdfCanvas.getContext("2d");
pdfCanvas.height=viewport.height;pdfCanvas.width=viewport.width;
await page.render({canvasContext:ctx,viewport}).promise;viewerBox.style.display="block";
timestamp.textContent="Viewed: "+new Date().toLocaleString("en-GB",{day:"2-digit",month:"short",year:"2-digit",hour:"2-digit",minute:"2-digit",hour12:true});};
reader.readAsArrayBuffer(file);}
function autoPreviewNewest(){if(!savedFiles.length)return;
const newest=savedFiles.sort((a,b)=>b.date-a.date)[0];showPDF(newest.name);}
if(savedFiles.length){savedFiles.sort((a,b)=>b.date-a.date);renderFiles();}

/* === Predictions === */
const generatorBox=document.getElementById("generatorBox");
const reqNum=document.getElementById("reqNum");const qty=document.getElementById("qty");
const genBtn=document.getElementById("genBtn");const resultGrid=document.getElementById("resultGrid");
let lastGenerated=JSON.parse(localStorage.getItem("lastGenerated")||"[]");
function showLast(){resultGrid.innerHTML="";lastGenerated.forEach(n=>{
const c=document.createElement("div");c.className="result-cell";c.textContent=n;resultGrid.appendChild(c);});}
showLast();
genBtn.onclick=()=>{const prefix=(reqNum.value||"").padStart(2,"0");
const count=parseInt(qty.value)||1;if(!/^\d{2}$/.test(prefix))return alert("Enter 2 digits!");
let generated=[],tries=0;while(generated.length<Math.min(count,15)&&tries<1000){
const rand=(Math.floor(Math.random()*100)).toString().padStart(2,"0");
const num=prefix+rand;if(!generated.includes(num))generated.push(num);tries++;}
lastGenerated=generated;localStorage.setItem("lastGenerated",JSON.stringify(lastGenerated));
resultGrid.innerHTML="";generated.forEach(n=>{const c=document.createElement("div");
c.className="result-cell new";c.textContent=n;resultGrid.appendChild(c);
setTimeout(()=>c.classList.remove("new"),300);});};
/* movable box */
let offX,offY,isDown=false;generatorBox.addEventListener("mousedown",startDrag);
generatorBox.addEventListener("touchstart",startDrag);
function startDrag(e){isDown=true;const ev=e.touches?e.touches[0]:e;
const r=generatorBox.getBoundingClientRect();offX=ev.clientX-r.left;offY=ev.clientY-r.top;
document.addEventListener("mousemove",moveDrag);document.addEventListener("mouseup",endDrag);
document.addEventListener("touchmove",moveDrag);document.addEventListener("touchend",endDrag);}
function moveDrag(e){if(!isDown)return;const ev=e.touches?e.touches[0]:e;
let x=ev.clientX-offX;let y=ev.clientY-offY;
x=Math.max(0,Math.min(innerWidth-generatorBox.offsetWidth,x));
y=Math.max(0,Math.min(innerHeight-generatorBox.offsetHeight,y));
generatorBox.style.left=x+"px";generatorBox.style.top=y+"px";}
function endDrag(){isDown=false;document.removeEventListener("mousemove",moveDrag);
document.removeEventListener("mouseup",endDrag);document.removeEventListener("touchmove",moveDrag);
document.removeEventListener("touchend",endDrag);}
</script>
</body>
</html>
